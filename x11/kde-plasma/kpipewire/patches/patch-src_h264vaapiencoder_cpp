Index: src/h264vaapiencoder.cpp
--- src/h264vaapiencoder.cpp.orig
+++ src/h264vaapiencoder.cpp
@@ -130,13 +130,25 @@ bool H264VAAPIEncoder::initialize(const QSize &size)
 
     switch (m_profile) {
     case H264Profile::Baseline:
+#ifdef AV_PROFILE_H264_CONSTRAINED_BASELINE
+        m_avCodecContext->profile = AV_PROFILE_H264_CONSTRAINED_BASELINE;
+#else
         m_avCodecContext->profile = FF_PROFILE_H264_CONSTRAINED_BASELINE;
+#endif
         break;
     case H264Profile::Main:
+#ifdef AV_PROFILE_H264_MAIN
+        m_avCodecContext->profile = AV_PROFILE_H264_MAIN;
+#else
         m_avCodecContext->profile = FF_PROFILE_H264_MAIN;
+#endif
         break;
     case H264Profile::High:
+#ifdef AV_PROFILE_H264_HIGH
+        m_avCodecContext->profile = AV_PROFILE_H264_HIGH;
+#else
         m_avCodecContext->profile = FF_PROFILE_H264_HIGH;
+#endif
         break;
     }
 
